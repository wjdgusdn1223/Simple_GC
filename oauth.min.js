var colorId=1;window.onload=function(){colorSel(),document.getElementById('title').focus(),$('#loader').hide(),document.getElementById('Cancel').addEventListener('click',function(){window.close()}),document.querySelector('#complete_btn').addEventListener('click',function(){$('#loader').show(),exceptionCheck()?chrome.identity.getAuthToken({interactive:!0},function(a){addSchedule(a)}):($('#loader').hide(),!$('#eMsg').is(':visible')&&$('#eMsg').transition('fade'))}),$('#start').calendar({type:'datetime',ampm:!1,monthFirst:!1}),$('#end').calendar({type:'datetime',ampm:!1,monthFirst:!1}),$('#close').on('click',function(){$(this).closest('#eMsg').transition('fade')}),$('#close2').on('click',function(){$(this).closest('#eMsg2').transition('fade')}),setInterval(popupResize,250)};function exceptionCheck(){return document.getElementById('title').value&&$('#start').calendar('get date')&&$('#end').calendar('get date')}function addSchedule(a){console.log(a);var b=$('#start').calendar('get date')+'',c=$('#end').calendar('get date')+'',d=b.split(' '),e=c.split(' ');d[1]=monthConvert(d[1]),e[1]=monthConvert(e[1]);var f=reminderCheck(),g={method:'POST',async:!0,headers:{Authorization:'Bearer '+a,'Content-Type':'application/json'},contentType:'json',body:JSON.stringify({start:{dateTime:d[3]+'-'+d[1]+'-'+d[2]+'T'+d[4]+'+09:00'},end:{dateTime:e[3]+'-'+e[1]+'-'+e[2]+'T'+e[4]+'+09:00'},colorId:colorId+'',visibility:'default',reminders:f,description:document.getElementById('desc').value,summary:document.getElementById('title').value})};console.log(g),fetch('https://www.googleapis.com/calendar/v3/calendars/primary/events?sendUpdates=all&key='+String.fromCharCode(65)+String.fromCharCode(73)+String.fromCharCode(122)+String.fromCharCode(97)+String.fromCharCode(83)+String.fromCharCode(121)+String.fromCharCode(68)+String.fromCharCode(115)+String.fromCharCode(121)+String.fromCharCode(65)+String.fromCharCode(121)+String.fromCharCode(120)+String.fromCharCode(52)+String.fromCharCode(122)+String.fromCharCode(69)+String.fromCharCode(85)+String.fromCharCode(115)+String.fromCharCode(69)+String.fromCharCode(114)+String.fromCharCode(119)+String.fromCharCode(112)+String.fromCharCode(95)+String.fromCharCode(95)+String.fromCharCode(72)+String.fromCharCode(78)+String.fromCharCode(53)+String.fromCharCode(121)+String.fromCharCode(85)+String.fromCharCode(110)+String.fromCharCode(109)+String.fromCharCode(109)+String.fromCharCode(99)+String.fromCharCode(101)+String.fromCharCode(107)+String.fromCharCode(117)+String.fromCharCode(77)+String.fromCharCode(106)+String.fromCharCode(50)+String.fromCharCode(56),g).then(function(h){if(console.log('Request success: ',h.status),200==h.status)window.close();else if(401==h.status)throw'token expired';else throw'Request / Response Error'}).catch(function(h){console.log('Request failure: ',h),'token expired'==h?chrome.identity.removeCachedAuthToken({token:a},function(){chrome.identity.getAuthToken({interactive:!0},function(j){addSchedule(j)})}):($('#loader').hide(),!$('#eMsg2').is(':visible')&&$('#eMsg2').transition('fade'))})}function colorSel(){for(var a=document.getElementsByName('BC'),b=0;b<a.length;b++)0<b&&(a[b].style.opacity='0.2'),$('#'+a[b].id).on('click',function(c){colorId=(c.toElement.id+'').split('_')[1];for(var d=document.getElementsByName('BC'),e=0;e<d.length;e++)d[e].style.opacity='0.2';document.getElementById(c.toElement.id+'').style.opacity='1.0'}),$('#'+a[b].id).hover(function(){$(this).css('opacity','1.0')},function(){($(this).attr('id')+'').split('_')[1]!=colorId&&$(this).css('opacity','0.2')})}function reminderCheck(){var a=document.getElementById('popup').value,b=document.getElementById('email').value;return selReminder=''===a&&''===b?{useDefault:!0}:''===a?{useDefault:!1,overrides:[{method:'email',minutes:b}]}:''===b?{useDefault:!1,overrides:[{method:'popup',minutes:a}]}:{useDefault:!1,overrides:[{method:'popup',minutes:a},{method:'email',minutes:b}]},selReminder}function monthConvert(a){return'Jan'===a?a='1':'Feb'===a?a='2':'Mar'===a?a='3':'Apr'===a?a='4':'May'===a?a='5':'Jun'===a?a='6':'Jul'===a?a='7':'Aug'===a?a='8':'Sep'===a?a='9':'Oct'===a?a='10':'Nov'===a?a='11':'Dec'===a?a='12':void 0,a}function popupResize(){($('html').height()!=$('#container').height()||$('html').width()!=$('#container').width())&&($('html').height($('#container').height()),$('html').width($('#container').width()))}